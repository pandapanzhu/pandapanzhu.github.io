* * *

layout: post

title:  初探WebFocus

date:   2017-08-10 22:32:00 +0800

categories: document

## tag: 学习笔记

* * *

*   content
{:toc}

不知道是哪根筋抽着了，博主最近竟然要去跟webfocus打交道，最近都被他整疯了。好记性不如烂笔头，学到的东西还是记下来比较好。

WebFocus 就博主目前的认知来看，就是一个报表的生成工具，依赖于数据库，将数据库中的数据经过相关的依赖或者手动的查询，生成一张一张的临时表，将表中的数据通过WebFocus展现出来。

# WebFocus初始化

## WebFocus的安装

1.  WebFocus因为是收费软件，所以一般用户是下载不了的，不过用户可以去[WebFocus官网](http://www.informationbuilders.com)查看文档，联系和购买相关服务。
2.  因为工作的关系，博主在这里只有安装包，激活码还是需要自行购买。读者可以在[百度云网盘]()中自行下载。
3.  在安装过程中需要输入相关激活信息，请自行购买。

## 数据库绑定

1.  WebFocus的开发者出了一些App Studio的使用教程，在购买相关产品时,进行相关的训练和培训。
2.  一个服务器中至少需要一个admin，这样方便管理其他developer，admin可以给新用户创建角色等操作，这样开发人员就直接能根据账号密码进行登录和开发。
3.  要进行开发，admin应该首先进行数据库的绑定等操作，其基本逻辑入下图所示。

4.  在WebFocus的主界面上，用户可以点击Environments，选择localhost,点击Property按钮就会看到相应的配置信息。如下图所示。

用户进行相关的配置之后，链接到WebFocus的服务器，链接到DataBase,就可以进行相应的开发了。

## 创建Masterfile

WebFocus有自己的服务器，关联的dataBase中的表在WebFocus中并不能直接使用，需要创建相应的Matadata.类似于SQL中的临时表，将所有的数据复制并转移到WebFocus的服务器中，这样才能进行查询。

1.  用户在展开Data Servers之后，会看到EDASERVE这个数据库的管理工具，在双击展开或者右键点击“Manage Adapters”之后，就可以选择相应的数据库，进行MasterFile的创建与管理。用户可根据自定义MasterFile的名字、前缀、后缀等信息。
2.  一张表只能创建一个MasterFile，不过一个MasterFile能包含其他的MaterFile,并进行相应的关联，类似于两张表之间的关联关系（inner Join,Left Join,Right Join）等。MasterFIle的关系就类似于
select * from table_a a left join table_b b on a.id=b.id;
其中 join 的关系 和on 后面的关系根据情况的变化而变化。

## 创建一个Procedure

*   用户创建了基本的MasterFile，就可以进行最基本的开发了。在LocalHost中创建文件夹，或者直接在某一个文件中创建一个Procedure，Procedure类似于一个存储过程，更类似于一个空白的画板，用户可以根据自己的需要include相应的东西。
为了方便，用户也可以直接新建一个report，在主页面的上面有一个report的按钮，点击或者右键文件夹--&gt;New 也可以生成一个Report，在新建report的时候，需要用户选择dataSource,也就是刚刚建立的MasterFile，这样会有一个默认的选择列表，用户可以根据需要拖动对应的数据到画板上，这样能自动呈现出报表的样式。

# 拖拽的使用场景

在WebFocus中，左侧展示的数据是直接从数据库中生成中，用户可以直接将数据表导入到WebFocus，然后再通过WebFocus的逻辑去实现对应的逻辑。也可以在其他框架中通过后台逻辑将需要展示的数据生成临时表，再将临时表导入到MasterFile，通过拖拽进行相应的报表生成。
具体的使用情况可以参照参考文献中的文档进行学习和使用。

# 使用WebFocus进行开发

在博主的项目开发中，直接使用拖拽的时间少之又少，大部分都是靠着自己写逻辑，拼接表来展示数据。
WebFocus类似于C语言，在开发过程中，面向过程进行开发，在开发过程中，非常难调试和测试。

## Function的用法

在WebFocus中，使用到function的地方还是比较的少,因为在WebFocus中，function中不能添加SQL语句等信息，只能写一个简单的逻辑判断，入判断字符串是否为空，判断数字是否等于0等行为。

      ISZERO(functionValue/ValueType)
        ISZERO/A5V=<span class="hljs-keyword">IF</span> functionValue EQ <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>  <span class="hljs-string">'T'</span> ESLE <span class="hljs-string">'F'</span>;
    <span class="hljs-keyword">END</span>
    `</pre>

    具体代码如上所示，在ISZERO这个function中，我们传入了一个叫functionValue的值，但还需要具体的指明这个Value的类型，如我们传了一个Number，则需要ValueType为I（number）， I是值Integer，后面跟数字是指长度，I3值3个数字这么长。同理，A5V就是指5个字符串长度的vchar类型。

    在此方法中，用户调用ISZERO这个function，传入一个数字，function会判断这个值是否为0，如果为0就返回‘T’不然就返回‘F’。

    ## MasterFile的使用

    在项目中，因为是根据需求还是比较明确的原因，所以在逻辑不是很复杂的情况下，我们可以直接建立MasterFile,其主要意义就是关联表与表之间的关系。如下代码所示

    <pre>`select * <span class="hljs-keyword">from</span> table_a a,table_b b <span class="hljs-keyword">where</span> a.<span class="hljs-property">id</span>=b.<span class="hljs-property">id</span> <span class="hljs-keyword">and</span> a.cityid=b,valueId;
    `</pre>

    在MaterFile中，我们只需要选择对应的两张表，然后将where后面的语句拖过**手写**或**拖拽**的方式，将关系建立在MasterFile中即可。

    ## 直接写SQL

    在项目中，我们也可以直接把SQL语句写在代码里，代码如下所示：

    <pre>`SQL
    <span class="hljs-keyword">SELECT</span>
    A.tablename,
    B.tableValue
    <span class="hljs-keyword">FROM</span> TABLE_A A,TABLE_B B,
    <span class="hljs-keyword">WHERE</span> A.ID=B.ID
    <span class="hljs-keyword">AND</span> A.CODE_VALUE=<span class="hljs-string">'PANDA'</span>
    ;
    TABLE
    <span class="hljs-keyword">ON</span> TABLE HOLD <span class="hljs-keyword">AS</span>  GET_VALUE_TABLE
    -RUN
    `</pre>

    在上述代码中，用户直接写了一个SQL查询出A表中的tablename和B表中的tableValue,放在了GET_VALUE_TABLE这个表里面，-RUN是指执行上述代码。所以在GET_VALUE_TABLE这个表里面，用户有TABLENAME和TABLEVALUE这两个字段可以使用。

    ## 读取TABLE的值

    在WebFocus中，如果我们如上述那样创建了一个TABLE,那我们要怎么读取TABLE中的值呢。

    <pre>`<span class="hljs-deletion">-READFILE GET_VALUE_TABLE</span>
    `</pre>

    这样我们就能读取 GET_VALUE_TABLE中第一行的值了，那如果我们要拿到TABLE中所有的数据，我们就应该：

    <pre>`-<span class="ruby"><span class="hljs-constant">SET</span>  &<span class="hljs-constant">Seria_num</span>=<span class="hljs-number">0</span>;
    </span>-<span class="ruby"><span class="hljs-constant">SET</span> &<span class="hljs-constant">TABEL_NUM</span>=&<span class="hljs-constant">LINES</span>;
    </span>-<span class="ruby"><span class="hljs-constant">REPEAT</span> <span class="hljs-constant">END_TABEL_LOOP</span> &<span class="hljs-constant">TABEL_NUM</span> <span class="hljs-constant">TIMES</span>;
    </span>-<span class="ruby"><span class="hljs-constant">SET</span> &<span class="hljs-constant">Seria_num</span>=&<span class="hljs-constant">Seria_num</span>+<span class="hljs-number">1</span>;
    </span>-<span class="ruby"><span class="hljs-constant">READFILE</span> <span class="hljs-constant">GET_VALUE_TABLE</span>;
    </span>-<span class="ruby"><span class="hljs-constant">TYPE</span> &<span class="hljs-constant">TABLENAME</span>
    </span>-<span class="ruby"><span class="hljs-constant">IF</span> &<span class="hljs-constant">Seria_num</span> <span class="hljs-constant">GE</span> &<span class="hljs-constant">TABEL_NUM</span> <span class="hljs-constant">THEN</span> <span class="hljs-constant">GOTO</span> <span class="hljs-constant">EXIT_TABLE_LOOP</span>;
    </span>-<span class="ruby"><span class="hljs-constant">END_TABLE_LOOP</span>
    </span>-<span class="ruby"><span class="hljs-constant">EXIT_TABLE_LOOP</span></span>
    `</pre>

    在上述的代码中，设置了一个初始的值&Seria_num为0，这是为了方便循环的结束。-REPEAT代表着循环的开始，循环到END_TABLE_LOOP这个标志为止，在循环体重，我们一直在**-READFILE GET_VALUE_TABLE** （读取GET_VALUE_TABLE中的值），并**-TYPE &TABLENAME**(将GET_VALUE_TABLE中的TABLENAME打印出来)。

    **注：&LINES是值上一个查询出来的table中信息的条数。**

    ## DEFINE的使用

    在查询出信息之后，有一些信息是需要经过加工和修改的。这个时候就要用到DEFINE了

    <pre>`DEFINE <span class="hljs-keyword">FILE</span> GET_VALUE_TABLE
        OUTPUT_1/A10V=TABLENAME || <span class="hljs-string">'-'</span> || TABLEVALUE;
        OUTPUT_2/A10V=<span class="hljs-keyword">IF</span> TABLENAME IS MISSING <span class="hljs-keyword">AND</span> TABLE     NAME EQ <span class="hljs-string">''</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'NULL'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IF</span> TABLEVALUE EQ  <span class="hljs-string">''</span> <span class="hljs-keyword">AND</span> ISZERO(TABLEVALUE) EQ  <span class="hljs-string">'T'</span> <span class="hljs-keyword">THEN</span> TABLENAME <span class="hljs-keyword">ELSE</span> OUT_PUT_1;

    <span class="hljs-keyword">END</span>
    `</pre>

    在上述代码中，经过前面的查询，我们得到了GET_VALUE_TABLE这个table,但我们想要的并不是查询出来的东西，例如我们需要将两个字段中间加一个“-”组合在一个形成一个新的字段。或者我们要判断他是不是为空，如果为空就显示其他的东西。

    ## 表之间的关联

    在运用中，我们有时候还会将两个TABLE联系在一起，这个时候我们有两种方法可以使用。先介绍第一种，使用**MATCH**方法。

    ### MATCH的使用

    代码如下：

    <pre>`MATCH <span class="hljs-keyword">FILE</span> GET_VALUE_TABLE
    <span class="hljs-keyword">PRINT</span> *
    OUTPUT_1
    BY TABLEVALUE
    RUN
    <span class="hljs-keyword">FILE</span> SQLRESULT
    <span class="hljs-keyword">PRINT</span> *
    BY TABLEVALUE
    AFTER MATCH HOLD AS GET_MATCHE_FILE_TABLE
    END
    `
    `</pre>

    在上述代码中，我们另外建了一张虚拟的表，叫SQLRESULT，用来被MATCH，需要注意的是，这里我们需要相同的一个字段叫TABLEVALUE，而且使用MATCH的话，两个字段的字段格式也需要相同，非常的具有局限性。

    ### 使用SQL进行关联

    在使用的场景中，我们也查询出来的TABLE其实就相当于一个视图，可以直接使用，所以我们可以用到SQL来实现表与表之间的关联。

    <pre>`SQL
    <span class="hljs-keyword">SELECT</span> *
    <span class="hljs-keyword">FROM</span> GET_TABLE_VALUE A LEFT <span class="hljs-keyword">JOIN</span> SQLRESULT B <span class="hljs-keyword">ON</span>  A.TABLEVALUE=B.TABLEVALUE
    ;
    TABLE 
    <span class="hljs-keyword">ON</span> TABLE HOLD <span class="hljs-keyword">AS</span> GET_JOIN_TABLE
    -RUN
    `</pre>

    在上述代码中，我们实现了与MATCH一样的效果，但是这种操作更加的方便和快捷，而且不限制的两个字段之间的格式。**推荐使用**
    当然，我们也可以用另外一种SQL方式来实现它，代码如下：

    <pre>`SQL
    <span class="hljs-keyword">SELECT</span> *
    <span class="hljs-keyword">FROM</span> GET_VALUE_TABLE A,SQLRESULT B
    <span class="hljs-keyword">WHERE</span> A.TABLEVALUE=DB_EXPR(B.TABLEVALUE(+))
    ;
    TABLE
    <span class="hljs-keyword">ON</span> TABLE HOLD <span class="hljs-keyword">AS</span> GET_JOIN_TABLE
    -RUN
    `</pre>

    两者的效果是一样的，但是**（+）**相当于是使用了SQL中的方法，在WebFocus中，使用到了SQL中的方法的话，是需要加上**DB_EXPR()**的。

    # 输出配置

    在WebFocus中，不过我们怎么样去配置数据，到最后都是需要打印出来的。

    其在不指定输出类型是，是以HTML的形式打印在页面上。除了HTML的形式，我们呢还可以输出PDF和XLSX两种格式。

    输出的格式一般如下所示：

    <pre>`TABLE FILE GET_VALUE_TABLE
    PRINT 
        COMPUTE SN=<span class="hljs-keyword">IF</span> TABLENAME EQ LAST TABLENAME <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> ESLE SN+<span class="hljs-number">1</span>; NOPRINT
        TABLENAME <span class="hljs-keyword">AS</span> <span class="hljs-comment">'Table Name'</span>
        OUTPUT_1 <span class="hljs-keyword">AS</span> Name+Value<span class="hljs-comment">'</span>
    <span class="hljs-keyword">BY</span> LOWEST SN <span class="hljs-keyword">AS</span> <span class="hljs-comment">'S/No.'</span>
    HEADING
    <span class="hljs-string">" <1><+0>Report ID:Test_Report"</span>

    <span class="hljs-keyword">ON</span> TABLE SUBHEAD
    <span class="hljs-string">"SUBHEAD"</span>

    <span class="hljs-keyword">ON</span> TABLE SUBFOOT
    <span class="hljs-string">"-------- No Records Found --------"</span>
    <span class="hljs-keyword">ON</span> TABLE <span class="hljs-keyword">SET</span> PAGE-NUM NOLEAD
    <span class="hljs-keyword">ON</span> TABLE <span class="hljs-keyword">SET</span> ASNAMES <span class="hljs-keyword">ON</span>
    <span class="hljs-keyword">ON</span> TABLE NOTOTAL
    <span class="hljs-keyword">ON</span> TABLE PCHOLD FORMAT XLSX
    <span class="hljs-keyword">ON</span> TABLE <span class="hljs-keyword">SET</span> HTMLCSS <span class="hljs-keyword">ON</span>
    <span class="hljs-keyword">ON</span> TABLE <span class="hljs-keyword">SET</span> STYLE *
        INCLUDE = IBFS:/EDA/EDASERVE/_EDAHOME/ETC/enwarm.sty,$
        TYPE=REPORT, SIZE=<span class="hljs-number">10</span>, FONT=<span class="hljs-comment">'Arial', HEADALIGN=BODY, WRAP=OFF, $</span>
    ENDSTYLE
    <span class="hljs-keyword">END</span>
    `</pre>

    上述代码的大致意思如下：

    现在我们要打印GET_VALUE_TABLE这张表了。

    打印的信息又 SN、TABLENAME、OUTPUT_1其中SN是我们最后通过计算的出来的，所以前面需要加上一个compute。

    NOPRINT 是指不显示在页面上，但BY Lowest  SN通过SN 从低到高的排序又显示在页面上了，而且在第一列。

    heading是指打印的页面的头部信息，subhead指次于头部的信息，footing和subfoot是指页面底部显示的信息。

    **ON TABLE PCHOLD FORMAT XLSX**表示了是通过XLSX(表格)的形式展示出来的。

    **ON TABLE SET STYLE *** 页面的样式可以在这里定义。_TYPE=REPORT, SIZE=10, FONT='Arial', HEADALIGN=BODY, WRAP=OFF,_这里是指，这个reprot中，字体大小统一为10号字体，‘Arial’字体格式，宽度自适应等。

    当然，我们也可以输入PDF的格式，只需要将“XLSX”修改成“PDF”就可以了.

    在HEADING中，**_<1>_**代表一个空格，**_<+0>_**代表了表格中的单元格的分割。

    # Conpound的使用

    在WebFocus中，Conpound属于比较高级的使用方法了，博主还没有琢磨透彻，先将我了解的先PO出来。

    ## 简单的ConPound

    使用Conpound需要遵循规律，在第一个要打印的TABLE中，设置Conpound为Open。在打印中过程的表，要一直处于NoBreak的阶段，在打印的最后一张表中要及时的关闭。

    实例如下：

    <pre>`-SET &COMPOUNDSTATUS =<span class="hljs-keyword">IF</span> &Serial_Num EQ <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-attribute">'OPEN</span>' <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IF</span>  &Serial_Num LT &Class_Num-<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-attribute">'NOBREAK</span>' <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IF</span> &Serial_Num EQ &Class_Num <span class="hljs-keyword">THEN</span> <span class="hljs-attribute">'CLOSE</span> <span class="hljs-keyword">ELSE</span> '';
    TABLE <span class="hljs-keyword">FILE</span> GET_VALUE_TABLE 
    ...
    <span class="hljs-keyword">ON</span> TABLE SET PAGE-NUM NOLEAD
    <span class="hljs-keyword">ON</span> TABLE SET ASNAMES <span class="hljs-keyword">ON</span>
    <span class="hljs-keyword">ON</span> TABLE NOTOTAL
    <span class="hljs-keyword">ON</span> TABLE PCHOLD FORMAT PDF &COMPOUNDSTATUS
    <span class="hljs-keyword">ON</span> TABLE SET HTMLCSS <span class="hljs-keyword">ON</span>
    <span class="hljs-keyword">ON</span> TABLE SET STYLE *
        INCLUDE = IBFS:/EDA/EDASERVE/_EDAHOME/ETC/enwarm.sty,$
        <span class="hljs-keyword">TYPE</span>=<span class="hljs-keyword">REPORT</span>, SIZE=<span class="hljs-number">10</span>, FONT=<span class="hljs-attribute">'Arial</span>', HEADALIGN=<span class="hljs-keyword">BODY</span>, WRAP=OFF, $
    ENDSTYLE
    <span class="hljs-keyword">END</span>

在上述代码中，我们先设置了一个**&amp;COMPOUNDSTATUS**的值，当他是一个 则在后面接上 **OPEN** 之间的我们在后面接上了 **NOBREAK**，在最后一个的时候我们接上了**CLOSE**。这样在循环中，打印多张GET_TABLE_VALUE时，并不会使打印中断。目前博主只是在PDF中，使用到了这种方法。

###### 2017-09-11，未完待续

# 写在最后

1.  WebFocus有自己的论坛，读者有其他的疑惑可以去论坛上发帖询问。地址是：[http://forums.informationbuilders.com/groupee](http://forums.informationbuilders.com/groupee)
2.  当然，读者也可以用Email询问博主，Email为：pandapanzhu@163.com
3.  用户需要参考文献，也可以通过邮件联系我。

    # 参考文献

4.  Hyperion_SQR_Guide

5.  WebFOCUS Bootcamp - Student Guide
6.  Bootcamp Exercises
7.  Webfocus 8.2 Function
8.  Webfocus 8.2 Create Report Language
9.  AppStudio_user_guide_8201M